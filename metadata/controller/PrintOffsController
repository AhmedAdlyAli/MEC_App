{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "PrintOffsController",
        "requires": [
            "MEC_App.view.PrintOffsView1"
        ]
    },
    "name": "MyController",
    "designerId": "0368eb08-6654-4c62-a283-ee255be7364b",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#btnPrintoffsNext",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "Ext.Button",
                "fn": "onBtnPrintoffsNextTap",
                "implHandler": [
                    "",
                    "// Create Case with Form Values",
                    "",
                    "",
                    "// validation",
                    "",
                    "var view = this.getPrintOffsView1();",
                    "",
                    "",
                    "var formData = view.getValues();",
                    "",
                    "",
                    "console.log(formData);",
                    "",
                    "",
                    "var err='';",
                    "",
                    "",
                    "if(formData.hiddenCompanyCR===''){",
                    "",
                    "    err+=\"برجاء اختيار الشركة \\n\";",
                    "}",
                    "",
                    "",
                    "",
                    "if(formData.hiddenPrintoutType===''){",
                    "",
                    "    err+=\"برجاء اختيار طريقة الاستلام\";",
                    "}",
                    "",
                    "",
                    "if(formData.txtNoOfCopies===''){",
                    "",
                    "    err+=\"برجاء اختيار عدد النسخ\";",
                    "}",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "if(err.length>0){",
                    "",
                    "    Ext.device.Notification.show({",
                    "        title: 'خطأ',",
                    "        buttons:[\"موافق\"],",
                    "        message: err",
                    "    });",
                    "}else{",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "    Ext.AnimationHelper.ShowLoading();",
                    "",
                    "    var requestData = {",
                    "        \"serviceId\": \"9\",",
                    "        \"token\": Ext.Global.userToken,",
                    "        \"language\": \"ar\",",
                    "        \"identityType\": 'QID',//Ext.Global.identityType,",
                    "        \"identityNum\": Ext.Global.identityNum,",
                    "        \"identityNationality\": Ext.Global.identityNationality,",
                    "        \"commercialRegistrationNum\":view.down('#hiddenCompanyCR').getValue(),",
                    "        \"caseType\":view.down('#hiddenPrintoutType').getValue(),",
                    "        \"establishmentSpcId\":\"\",",
                    "        \"caseSubType\":\"01\",",
                    "        \"contactId\":\"\",",
                    "        \"numOfCopies\":view.down('#txtNoOfCopies').getValue(),",
                    "        \"moiEstablishmentNum\":\"\",",
                    "        \"qatarChamberNum\":\"\",",
                    "        \"commercialPermitNum\":\"\",",
                    "        \"economicalNum\":\"\"",
                    "    };",
                    "",
                    "",
                    "",
                    "    Ext.Ajax.request({",
                    "",
                    "        url : Ext.Global.GetConfig('webServiceUrl'),",
                    "        method : 'POST',",
                    "        jsonData :requestData,",
                    "        success : function (response) {",
                    "            var json = Ext.util.JSON.decode(response.responseText);",
                    "            json.NoOfCopies = view.down('#txtNoOfCopies').getValue();",
                    "            //console.log(json);",
                    "            Ext.Viewport.getActiveItem().push({",
                    "                xtype: 'PrintOffsView2',",
                    "                title: Ext.Global.GetFixedTitle(),",
                    "                data: json",
                    "            });",
                    "",
                    "",
                    "",
                    "",
                    "            Ext.AnimationHelper.HideLoading();",
                    "",
                    "",
                    "        }",
                    "    });",
                    "",
                    "",
                    "}",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    ""
                ],
                "name": "tap"
            },
            "name": "onBtnPrintoffsNextTap",
            "designerId": "0233c940-3fd3-4fdd-a6cd-0c6b4a4f6419"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "PrintOffsView1",
                "selector": "#PrintOffsView1"
            },
            "name": "PrintOffsView1",
            "designerId": "77def958-c6bf-42c4-b0ae-91fc009675a9"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "panel#PrintOffsView2",
                "designer|params": [
                    "component",
                    "eOpts"
                ],
                "designer|targetType": "Ext.Panel",
                "fn": "onPrintOffsView2Initialize",
                "implHandler": [
                    "",
                    "var view = this.getPrintOffsView2();",
                    "var json = view.getData();",
                    "",
                    "",
                    "view.down('#lblRequestType').setHtml(json.listOfMecBssCreatedCaseIo.mecLlcEstablishment[0].type);",
                    "",
                    "view.down('#lblNoCopies').setHtml(json.NoOfCopies);",
                    "",
                    "view.down('#lblCompanyName').setHtml(json.listOfMecBssCreatedCaseIo.mecLlcEstablishment[0].orgNameARA);",
                    "view.down('#lblTotalFees').setHtml(json.listOfMecBssCreatedCaseIo.mecLlcEstablishment[0].listOfMecCaseFees.mecCaseFees[0].feesTotalValue);",
                    "",
                    "",
                    "",
                    "view.down('#lblRequestNo').setHtml(json.listOfMecBssCreatedCaseIo.mecLlcEstablishment[0].serialNumber);",
                    "view.down('#hiddenSerialNo').setValue(json.listOfMecBssCreatedCaseIo.mecLlcEstablishment[0].recordID);",
                    "",
                    "view.down('#lblRequestStatus').setHtml(json.listOfMecBssCreatedCaseIo.mecLlcEstablishment[0].status);",
                    "",
                    "var noOfAttachments = json.listOfMecBssCreatedCaseIo.mecLlcEstablishment[0].listOfMecUnifiedAttachmentParameters.mecUnifiedAttachmentParameters.length;",
                    "",
                    "",
                    "if(noOfAttachments===0){",
                    "    view.down('#lblRequiredAttachments').setHtml('لا يوجد');",
                    "}",
                    "",
                    "",
                    "console.log('data assigned for case: ' + json.listOfMecBssCreatedCaseIo.mecLlcEstablishment[0].recordID );",
                    "console.log(view.down('#lblNoCopies'));",
                    ""
                ],
                "name": "initialize"
            },
            "name": "onPrintOffsView2Initialize",
            "designerId": "3eafd1aa-1a1a-438d-ac6e-7a14b35734d4"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "panel#PrintOffsView2",
                "designer|params": [
                    "component",
                    "eOpts"
                ],
                "designer|targetType": "Ext.Panel",
                "fn": "onPrintOffsView2Show",
                "implHandler": [
                    ""
                ],
                "name": "show"
            },
            "name": "onPrintOffsView2Show",
            "designerId": "56488d79-f7b5-45f6-9355-8edc548f0dc7"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "PrintOffsView2",
                "selector": "#PrintOffsView2"
            },
            "name": "PrintOffsView2",
            "designerId": "58420c99-6c2e-4df2-ab37-270ec7d63403"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#btnPrintoffs2Next",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "Ext.Button",
                "fn": "onBtnPrintoffs2NextTap",
                "implHandler": [
                    "Ext.AnimationHelper.ShowLoading();",
                    "",
                    "var view = this.getPrintOffsView2();",
                    "var serialNo =  view.down('#hiddenSerialNo').getValue();",
                    "",
                    "",
                    "console.log(serialNo);",
                    "",
                    "var formData = view.getData();",
                    "",
                    "",
                    "",
                    "",
                    "var requestData = {",
                    "    \"serviceId\": \"10\",",
                    "    \"token\": Ext.Global.userToken,",
                    "    \"objectSpcId\": serialNo,",
                    "    \"caseSerialNum\":\"\"",
                    "};",
                    "",
                    "",
                    "Ext.Ajax.request({",
                    "",
                    "    url : Ext.Global.GetConfig('webServiceUrl'),",
                    "    method : 'POST',",
                    "    jsonData :requestData,",
                    "    success : function (response) {",
                    "        var json = Ext.util.JSON.decode(response.responseText);",
                    "",
                    "",
                    "",
                    "",
                    "        Ext.AnimationHelper.HideLoading();",
                    "",
                    "",
                    "        if(json.statusMsg!='success')",
                    "        {",
                    "",
                    "            var company = formData.listOfMecBssCreatedCaseIo.mecLlcEstablishment[0];",
                    "            json.recordID = company.caseNum;",
                    "            json.typeCode = company.typeCode;",
                    "            json.fees = company.listOfMecCaseFees.mecCaseFees[0].feesTotalValue;",
                    "            json.locale = 'ar';",
                    "",
                    "",
                    "",
                    "",
                    "            Ext.Viewport.getActiveItem().push({",
                    "                xtype: 'PrintOffsView3',",
                    "                title: Ext.Global.GetFixedTitle(),",
                    "                data: json",
                    "            });",
                    "        }else{",
                    "",
                    "",
                    "            Ext.device.Notification.show({",
                    "                title: 'خطأ',",
                    "                buttons: [\"موافق\"],",
                    "                message:  'json.statusMsg'",
                    "            });",
                    "",
                    "        }",
                    "",
                    "",
                    "",
                    "    }",
                    "});",
                    "",
                    "",
                    "",
                    "",
                    ""
                ],
                "name": "tap"
            },
            "name": "onBtnPrintoffs2NextTap",
            "designerId": "8a6b7185-3f88-4567-a743-c92f2a91baa4"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "panel#PrintOffsView3",
                "designer|params": [
                    "component",
                    "eOpts"
                ],
                "designer|targetType": "Ext.Panel",
                "fn": "onPrintOffsView3Initialize",
                "implHandler": [
                    "var view = component;",
                    "var data = view.getData();",
                    "",
                    "console.log(data);",
                    "",
                    " Ext.Function.defer(function(){",
                    "// payment gateway redirection",
                    "",
                    "        var form = Ext.create('Ext.form.Panel', {",
                    "                standardSubmit: true,",
                    "                url: 'http://eservicesstg.mec.gov.qa/QNB_PaymentGateway/CS_VPC_3Party_DO_mob.aspx',",
                    "                method: 'POST',",
                    "            items: [",
                    "                {xtype: 'textfield',name: 'vpc_MerchTxnRef'},",
                    "                {xtype: 'textfield',name: 'vpc_OrderInfo'},",
                    "                {xtype: 'textfield',name: 'vpc_Amount'},",
                    "                {xtype: 'textfield',name: 'vpc_Locale'}",
                    "            ],",
                    "            });",
                    "",
                    "",
                    "        form.setValues({",
                    "                    vpc_MerchTxnRef: data.recordID, //'Ahmed Adly Ali',",
                    "                    vpc_OrderInfo: data.caseSerialNum + '_' + data.typeCode,//'Test',",
                    "                    vpc_Amount: data.fees,",
                    "                    vpc_Locale : data.locale",
                    "",
                    "                });",
                    "",
                    "        form.element.dom.target = 'paymentframe';",
                    "        form.submit(); //{target: 'paymentframe'}",
                    "",
                    "",
                    " } ,\t400,this);"
                ],
                "name": "initialize"
            },
            "name": "onPrintOffsView3Initialize",
            "designerId": "647c726d-2517-45b3-b9e8-3f9f26df1274"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "formpanel#PrintOffsView1",
                "designer|params": [
                    "component",
                    "eOpts"
                ],
                "designer|targetType": "Ext.form.Panel",
                "fn": "onPrintOffsView1Initialize",
                "implHandler": [
                    "Ext.AnimationHelper.ShowLoading();",
                    "",
                    "",
                    "var requestData = {",
                    "    \"serviceId\": \"2\",",
                    "    \"token\": Ext.Global.userToken,",
                    "    \"language\": \"ar\",",
                    "    \"identityType\":'QID', //Ext.Global.identityType,",
                    "    \"identityNum\": Ext.Global.identityNum,",
                    "    \"identityNationality\":  Ext.Global.identityNationality",
                    "};",
                    "",
                    "",
                    "var me = this;",
                    "",
                    "Ext.Ajax.request({",
                    "",
                    "    url : Ext.Global.GetConfig('webServiceUrl'),",
                    "    method : 'POST',",
                    "    jsonData :requestData,",
                    "    success : function (response) {",
                    "",
                    "        var json = Ext.util.JSON.decode(response.responseText);",
                    "",
                    "",
                    "        var view = me.getPrintOffsView1();",
                    "",
                    "        view.setData(json.listOfPrimaryEstablishment.primaryEstablishment);",
                    "",
                    "        Ext.AnimationHelper.HideLoading();",
                    "",
                    "",
                    "",
                    "",
                    "    }",
                    "});",
                    ""
                ],
                "name": "initialize"
            },
            "name": "onPrintOffsView1Initialize",
            "designerId": "044f28fe-ecd9-4b15-a79d-30d61b9e00c7"
        }
    ]
}