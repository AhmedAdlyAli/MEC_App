{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "SupplyServiceController",
        "designer|userClassName": "SupplyServiceController"
    },
    "name": "MyController",
    "designerId": "d8a2aa82-54b8-4881-85df-6ce7ae4aa4af",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "panel#SupplyServiceView1",
                "designer|params": [
                    "component",
                    "eOpts"
                ],
                "designer|targetType": "Ext.Panel",
                "fn": "onSupplyServiceView1Initialize",
                "implHandler": [
                    "",
                    "var me = this;",
                    "",
                    "",
                    "var url2 = Ext.Global.GetConfig('supplyWebServiceUrl')+ '/GetFamilyItemDetails';",
                    "",
                    "var language = Ext.Global.LanguageFlag == 'en' ? 1 : 2;",
                    "",
                    "var requestData2 = {\"qid\":\"21463400042\", \"languageID\":language, \"mobileDeviceID\":\"1231\"};",
                    "",
                    "",
                    "//Ext.AnimationHelper.ShowLoading();",
                    "",
                    "Ext.Ajax.request({",
                    "",
                    "    url : url2,",
                    "    method : 'POST',",
                    "    jsonData :requestData2,",
                    "    success : function (response) {",
                    "",
                    "        var json1 = Ext.util.JSON.decode(response.responseText);",
                    "        var json2 = Ext.util.JSON.decode(json1.d);",
                    "",
                    "",
                    "        var fsItems = me.getFsItems();",
                    "",
                    "",
                    "         Ext.each(json2.Data.Items, function(item){",
                    "",
                    "                fsItems.add(",
                    "",
                    "                    {",
                    "                        xtype: 'spinnerfield',",
                    "                        label: item.Name,",
                    "                        placeholder: item.Name,",
                    "                        value: item.AllocatedQty,",
                    "                        name: item.ItemID,",
                    "                        stepValue: 1,",
                    "                        minValue: 0,",
                    "                        maxValue:100,",
                    "                        listeners : {",
                    "                            spin : function(spinnerfield, newValue, direction, eOpts) {",
                    "                                if(newValue>item.AllocatedQty){",
                    "                                    this.setValue(item.AllocatedQty);",
                    "                                }",
                    "                            }",
                    "                        }",
                    "",
                    "",
                    "",
                    "                     }",
                    "",
                    "                );",
                    "",
                    "            });",
                    "",
                    "",
                    "",
                    "        Ext.AnimationHelper.HideLoading();",
                    "",
                    "",
                    "    },",
                    "    failure: function(request, resp) {",
                    "        alert(\"in failure\");",
                    "    }",
                    "});",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    ""
                ],
                "name": "initialize"
            },
            "name": "onSupplyServiceView1Initialize",
            "designerId": "8a6d8fd0-ef3f-4876-a07d-0bf55bc4ceb8"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#btnSupplyNext1",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "Ext.Button",
                "fn": "onBtnSupplyNext1Tap",
                "implHandler": [
                    "",
                    "",
                    "var view = this.getSupplyServiceView1();",
                    "",
                    "",
                    "Ext.Viewport.getActiveItem().push({",
                    "    xtype: 'SupplyServiceView2',",
                    "    title:  Ext.Global.GetFixedTitle(),",
                    "    data: view.getValues()",
                    "});",
                    "",
                    "",
                    ""
                ],
                "name": "tap"
            },
            "name": "onBtnSupplyNext1Tap",
            "designerId": "b6627f29-ed00-48bb-a2f5-19e325092a38"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "lblFamilyCount",
                "selector": "#lblFamilyCount"
            },
            "name": "lblFamilyCount",
            "designerId": "befb1f3b-f155-454c-98a6-fc2d6fab2cd2"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "fsItems",
                "selector": "#fsItems"
            },
            "name": "fsItems",
            "designerId": "e2d70b72-db67-4a6d-9ce3-0c4024d31635"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SupplyServiceView1",
                "selector": "SupplyServiceView1"
            },
            "name": "SupplyServiceView1",
            "designerId": "cfc0d26d-ac1a-44cb-832b-1070d77e24bb"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SupplyServiceView2",
                "selector": "SupplyServiceView2"
            },
            "name": "SupplyServiceView2",
            "designerId": "35b09e41-a71c-45d4-89ac-38e07832db88"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "panel#SupplyServiceView2",
                "designer|params": [
                    "component",
                    "eOpts"
                ],
                "designer|targetType": "Ext.Panel",
                "fn": "onSupplyServiceView2Initialize",
                "implHandler": [
                    "",
                    "// initialize google maps",
                    "var view = component;",
                    "",
                    "console.log(view.getData());",
                    "",
                    "Ext.Function.defer(function(){",
                    "",
                    "",
                    "    var mapPanel = view.down('#mapDealers');",
                    "    var gMap = mapPanel.getMap();",
                    "",
                    "        gMap.setCenter(new google.maps.LatLng (25.321283,51.528329));",
                    "        gMap.setZoom(11);",
                    "",
                    "",
                    "    // get dealers",
                    "",
                    "    var url = Ext.Global.GetConfig('supplyWebServiceUrl')+ '/GetNearbyDealers';",
                    "",
                    "",
                    "    var orderItems =[];",
                    "    var formData = view.getData();",
                    "",
                    " for (var key in formData) {",
                    "  if (formData.hasOwnProperty(key)) {",
                    "        orderItems.push({ ItemID: key, value: formData[key] });",
                    "  }",
                    "}",
                    "",
                    "",
                    "",
                    "",
                    "    var language = Ext.Global.LanguageFlag == 'en' ? 1 : 2;",
                    "",
                    "    var requestData =  {\"qid\":\"24263400239\",",
                    "                        \"languageID\":language,",
                    "                        \"mobileDeviceID\":\"1231\",",
                    "                        \"restrictDealerBasedOnStock\":\"true\",",
                    "                        \"latitude\":\"25.321283\",//location.lat,",
                    "                        \"longtitude\":\"51.528329\",//location.lng,",
                    "                        \"orderItems\": orderItems",
                    "                       };",
                    "",
                    "",
                    "//console.log(requestData);",
                    "",
                    "",
                    "    Ext.AnimationHelper.ShowLoading();",
                    "",
                    "    Ext.Ajax.request({",
                    "",
                    "        url : url,",
                    "        method : 'POST',",
                    "        jsonData :requestData,",
                    "        success : function (response) {",
                    "",
                    "            var json1 = Ext.util.JSON.decode(response.responseText);",
                    "            var json2 = Ext.util.JSON.decode(json1.d);",
                    "",
                    "",
                    "            Ext.AnimationHelper.HideLoading();",
                    "",
                    "",
                    "           console.log(json2);",
                    "",
                    "",
                    "",
                    "     var infowindow = new google.maps.InfoWindow();",
                    "",
                    "",
                    "        Ext.each(json2.Data.Dealers,function(item){",
                    "",
                    "                var marker = new google.maps.Marker({",
                    "                    map: gMap,",
                    "                    animation: google.maps.Animation.DROP,",
                    "                    position: new google.maps.LatLng(item.Longtitude,item.Latitude),",
                    "                    icon: 'resources/images/drop-pin.png',",
                    "                    data:item",
                    "                });",
                    "",
                    "",
                    "",
                    "",
                    "             google.maps.event.addListener(marker,'click',function(pos) {",
                    "",
                    "                    var info = '<div style=\"font-size:16px;font-family:PFDinTextUniversal;padding-right:5px\" class=\"branch-title\">'+marker.data.DealerName+'</div>';",
                    "                       infowindow.setContent(info);",
                    "                       infowindow.open(gMap,marker);",
                    "",
                    "                   view.down('#lblTitle').setHtml(marker.data.DealerName);",
                    "                   view.down('#lblAddress').setHtml(marker.data.Address);",
                    "                   view.down('#hiddenDealerID').setValue(marker.data.DealerID);",
                    "",
                    "",
                    "",
                    "                 console.log(marker.data.DealerID);",
                    "",
                    "",
                    "                 formData.DealerID = marker.data.DealerID;",
                    "",
                    "                 view.setData(formData);",
                    "",
                    "",
                    "",
                    "                });",
                    "",
                    "",
                    "",
                    "",
                    "        });",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "        },",
                    "        failure: function(request, resp) {",
                    "            alert(\"in failure\");",
                    "        }",
                    "    });",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "}, 1100,this);",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    ""
                ],
                "name": "initialize"
            },
            "name": "onSupplyServiceView2Initialize",
            "designerId": "d1d27db0-3a64-48ed-a03a-86b07e468631"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SupplyServiceView3",
                "selector": "SupplyServiceView3"
            },
            "name": "SupplyServiceView3",
            "designerId": "06b8a4ac-043b-4723-a5af-bf3de35e6a3e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#btnSupplyNext2",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "Ext.Button",
                "fn": "onBtnSupplyNext2Tap",
                "implHandler": [
                    "var view = this.getSupplierServiceView3();",
                    "",
                    "console.log(view.getData());",
                    "",
                    "// collect form data",
                    "// get supplier",
                    "// call allocate to get fees",
                    "",
                    ""
                ],
                "name": "tap"
            },
            "name": "onBtnSupplyNext2Tap",
            "designerId": "b6a95fee-e40d-4d94-a19e-bad42de1ec1f"
        }
    ]
}